{
  "metadata": {
    "epic": "Driver's License Reissuance",
    "feature": "License Reissuance",
    "severity": "Critical",
    "tags": [
      "License Reissuance",
      "Generate Temporal licence",
      "Biometrics verification",
      "Generate licence"
    ],
    "expectedResults": [
      "Applicant should successfully login into his account",
      "Supporting document should be successfully uploaded",
      "Applicant should successfully initiate payment",
      "System should successfully verify payment",
      "System should successfully validate payment",
      "Temporary License should be successfully generated",
      "Applicant should successfully receive OTP",
      "OTP should be successfully validated",
      "System should successfully verifies license number",
      "Applicant's face should  be successfully validated",
      "Applicant's bio data should display successfully",
      "Applicant's signature should be successfully Uploaded",
      "License should be successfully generated"
    ]
  },
  "steps": [
    {
      "story": "Login",
      "name": "Applicant logins to their account",
      "method": "POST",
      "path": "auth/self-service/login",
      "body": {
        "email": "${studentEmailDrivingSchool}",
        "password": "Password@1234"
      },
      "assertions": {
        "status": 201
      },
      "extract": {
        "applicant_token": "data.accessToken"
      },
      "expectedResults": [
        "Applicant should successfully login into his account"
      ]
    },
    {
      "story": "Upload document",
      "name": "Applicant uploads supporting document",
      "method": "POST",
      "path": "files",
      "requires": [
        "base64Image"
      ],
      "body": {
        "base64Image": "${base64Image}",
        "documentType": "cac",
        "fileName": "Certificate_2025-07-30T12:33:38.340Z",
        "mimeType": "image/jpeg"
      }
    },
    {
      "story": "Initiate payment",
      "name": "Initialize payment with auto detect feature",
      "method": "POST",
      "path": "payments/initiate",
      "requires": [
        "applicant_token",
        "paymentReference"
      ],
      "body": {
        "type": "license_replacement_payment",
        "drivingSchoolId": "14",
        "password": "Password@1234",
        "email": "${studentEmailDrivingSchool}",
        "currency": "NGN",
        "successRedirectUrl": "http://localhost:4200/new-registration-confirmation?",
        "failureRedirectUrl": "http://localhost:4200/staging/payment-failed?",
        "description": "license_replacement_payment"
      },
      "assertions": {
        "status": 201
      },
      "extract": {
        "paymentReference": "reference"
      },
      "expectedResults": []
    },
    {
      "story": "verify payment",
      "name": "verify payment after client has been redirected. This sets the payment to completed if successfully verified.",
      "method": "POST",
      "path": "payments/verify",
      "requires": [
        "applicant_token",
        "paymentReference"
      ],
      "body": {
        "type": "license_replacement_payment",
        "reference": "${paymentReference}"
      },
      "assertions": {
        "status": 201
      }
    },
    {
      "story": "validate payment",
      "path": "payments/validate-transaction",
      "method": "POST",
      "name": "Validate the status of a transaction",
      "body": {
        "type": "license_replacement_payment",
        "reference": "${paymentReference}"
      },
      "assertions": {
        "status": 404
      }
    },
    {
      "story": "MVAA officer login",
      "name": "MVAA officer logs into mobile app account",
      "method": "POST",
      "path": "auth/login",
      "body": {
        "email": "agyakoji+500@gmail.com",
        "password": "Password@1234"
      },
      "extract": {
        "mvaa_officer_token": "accessToken"
      },
      "assertions": {},
      "expectedResults": [
        "MVAA Officer should successfully login"
      ]
    },
    {
      "story": "Capture MVAA officer's biometric",
      "name": "MVAA officer does fingerprint for verification",
      "method": "POST",
      "path": "users/update-biometrics",
      "requires": [
        "mvaa_officer_token"
      ],
      "body": {
        "email": "agyakoji+50@gmail.com",
        "files": [
          {
            "documenType": "finger",
            "fingerType": "right_thumb",
            "fileId": 1
          }
        ]
      }
    },
    {
      "story": "Contact validation",
      "name": "Send OTP to supplied email or phone",
      "method": "POST",
      "path": "auth/send-otp",
      "body": {
        "email": "${studentEmailDrivingSchool}",
        "phone": "${drivingSchoolPhone}"
      }
    },
    {
      "story": "Receive OTP",
      "name": "Validate OTP sent to supplied email or phone",
      "method": "POST",
      "path": "auth/validate-otp",
      "body": {
        "email": "${studentEmailDrivingSchool}",
        "phone": "${drivingSchoolPhone}",
        "otp": "123456"
      }
    },
    {
      "story": "License number validation",
      "name": "Validate Applicant's license number",
      "method": "POST",
      "path": "license/verify",
      "requires": [
        "licenseNo",
        "certificateNo"
      ],
      "body": {
        "licenseNo": "${licenseNo}",
        "studentCertNo": "${certificateNo}"
      }
    },
    {
      "story": "Face validation",
      "name": "Verify applicant NIN via face capture/face match",
      "method": "GET",
      "path": "auth/verify-nin/94148931536",
      "assertions": {},
      "expectedResults": [
        "Applicant's face should  be successfully validated"
      ]
    },
    {
      "story": "Applicant's biodata",
      "name": "Get license details by license number",
      "method": "GET",
      "path": "license/details-by-license-no",
      "requires": [
        "licenseNo",
        "certificateNo"
      ],
      "body": {
        "licenseNo": "${licenseNo}",
        "studentCertNo": "${certificateNo}"
      }
    },
    {
      "story": "Submit license request",
      "name": "Submit new license request",
      "method": "POST",
      "path": "biometrics/submit-biometric-results",
      "requires": [
        "mvaa_officer_token"
      ],
      "body": {
        "licenseRequestId": 1,
        "status": "passed",
        "files": [
          {
            "fileId": 0,
            "documentType": "string",
            "fingerType": "string"
          }
        ],
        "notes": "Biometric capture completed successfully"
      }
    },
    {
      "story": "Upload signature",
      "name": "Upload applicant's signature",
      "method": "POST",
      "path": "files",
      "requires": [
        "base64Image"
      ],
      "body": {
        "base64Image": "${base64Image}",
        "documentType": "cac",
        "fileName": "Certificate_2025-07-30T12:33:38.340Z",
        "mimeType": "image/jpeg"
      }
    },
    {
      "story": "Generate License",
      "name": "Generate new license",
      "method": "GET",
      "path": "license/generate-license/${licenseNo}",
      "requires": [
        "licenseNo"
      ],
      "assertions": {},
      "expectedResults": [
        "License should be successfully generated"
      ]
    }
  ]
}