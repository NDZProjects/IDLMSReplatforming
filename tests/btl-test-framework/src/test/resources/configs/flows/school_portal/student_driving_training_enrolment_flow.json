{
  "metadata": {
    "epic": "Student driving school enrollment",
    "feature": "Enroll into driving school",
    "severity": "Critical",
    "tags": [
      "Driving school",
      "enrollment",
      "NIN"
    ],
    "expectedResults": [
      "Applicant should successfully logs into their account",
      "Applicant should successfully access the school enrolment page",
      "Applicant should successfully select state, LGA, physical condition and preferred school",
      "Applicant's NIN should be successfully validated",
      "Applicant should successfully made payment",
      "System should successfully verify the payment",
      "Applicant should successfully submit driving lesson application"
    ]
  },
  "steps": [
    {
      "story": "Login",
      "name": "Applicant logs into their account.",
      "method": "POST",
      "path": "auth/self-service/login",
      "body": {
        "email": "${studentEmailDrivingSchool}",
        "password": "Password@1234"
      },
      "assertions": {
        "status": 201
      },
      "extract": {
        "applicant_token": "data.accessToken"
      },
      "expectedResults": [
        "Applicant should successfully login into his account"
      ]
    },
    {
      "story": "Driving school enrollment",
      "name": "Applicant accesses the school enrollment page",
      "method": "GET",
      "path": "notifications/unread-count",
      "requires": [
        "applicant_token"
      ],
      "assertions": {
        "status": 200
      },
      "expectedResults": [
        "Applicant should successfully access the school enrolment page"
      ]
    },
    {
      "story": "Applicant location, Student physical deficiency and preferred driving school",
      "name": "Applicant selects State and LGA, physical condition and preferred driving school",
      "method": "GET",
      "path": "driving-school/get-by-license-class",
      "requires": [
        "applicant_token"
      ],
      "assertions": {
        "status": 200
      },
      "expectedResults": [
        "Applicant should successfully select state",
        "LGA",
        "physical condition and preferred school"
      ],
      "query": {
        "lgaId": 504,
        "stateId": 25,
        "page": 1,
        "resultPerPage": 100,
        "class": "B"
      }
    },
    {
      "story": "NIN validation",
      "name": "Applicant carries NIN validation",
      "method": "GET",
      "path": "auth/verify-nin/94089085948",
      "assertions": {
        "status": 200
      },
      "requires": [
        "applicant_token"
      ],
      "expectedResults": [
        "Applicant's NIN should be successfully validated"
      ]
    },
    {
      "story": "Initiate payment",
      "name": "Applicant makes application payment",
      "method": "POST",
      "path": "payments/initiate",
      "body": {
        "type": "driving_school_application_payment",
        "email": "${studentEmailDrivingSchool}",
        "description": "Driving School Application Payment",
        "successRedirectUrl": "http://localhost:4200/new-registration-confirmation?",
        "failureRedirectUrl": "http://localhost:4200/staging/payment-failed?"
      },
      "requires": [
        "applicant_token"
      ],
      "extract": {
        "paymentReference": "reference"
      },
      "assertions": {
        "status": 201
      },
      "expectedResults": [
        "Applicant should successfully made payment"
      ]
    },
    {
      "story": "Verify payment",
      "name": "System verifies payment",
      "method": "POST",
      "path": "payments/verify",
      "body": {
        "type": "driving_school_application_payment",
        "reference": "${paymentReference}"
      },
      "requires": [
        "applicant_token",
        "paymentReference"
      ],
      "assertions": {
        "status": 201
      },
      "expectedResults": [
        "System should successfully verify the payment"
      ]
    },
    {
      "story": "Submit driving lesson application",
      "name": "Applicant submits driving lesson application",
      "method": "POST",
      "path": "driving-school/v4/submit-driving-lesson-application",
      "requires": [
        "applicant_token"
      ],
      "body": {
        "titleId": 1,
        "drivingSchoolId": 14,
        "firstName": "Valentine",
        "lastName": "Ogoshi",
        "middleName": null,
        "dateOfBirth": "20-01-1990",
        "genderId": 1,
        "placeOfBirth": "Doma",
        "nationalityId": 1,
        "stateOfOriginId": 25,
        "lgaOfOriginId": 504,
        "address": "29/31 Matthew Attah Akwe Street",
        "phone": "08119820741",
        "email": "${studentEmailDrivingSchool}",
        "nextOfKinName": "Damian",
        "nextOfKinRelationshipId": 1,
        "nextOfKinPhone": "09068928321",
        "nextOfKinNationalityId": 1,
        "nin": "94089085948",
        "maidenName": "Omadefu",
        "maritalStatusId": 1,
        "bloodGroupId": 8,
        "occupationId": 6,
        "files": [
          {
            "documentType": "face",
            "fileId": 1652
          }
        ],
        "height": 6,
        "weight": 80,
        "facialMarks": "No",
        "glasses": "No",
        "disability": "No",
        "eyeColor": "HAZEL",
        "stateId": 25,
        "residentialStateId": 25,
        "residentialLgaId": 504,
        "town": "Doma",
        "successRedirectUrl": "https://driverslicense.public.verxid.site/dashboard?",
        "failureRedirectUrl": "https://driverslicense.public.verxid.site/payment-failed"
      },
      "extract": {
        "applicationID": "data.applicationId"
      },
      "assertions": {
        "status": 201
      },
      "expectedResults": [
        "Applicant should successfully submit driving lesson application"
      ]
    }
  ]
}