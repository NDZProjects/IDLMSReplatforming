{
  "metadata": {
    "epic": "Mobile DVIS",
    "feature": "Driving Test Renewal",
    "severity": "critical",
    "tags": [
      "driving_test",
      "otp",
      "license",
      "submission"
    ],
    "expectedResults": [
      "Send OTP returns status 201.",
      "Validate OTP returns status 201.",
      "Verify license returns status code 201",
      "Driving test submission returns status 201."
    ]
  },
  "steps": [
    {
      "story": "Send OTP for driving test flow",
      "name": "driving_test_flow: Send OTP",
      "method": "POST",
      "path": "auth/send-otp",
      "body": {
        "email": "vickkycodegenius@gmail.com"
      },
      "requires": [
        "super_admin_token"
      ],
      "assertions": {
        "status": 201
      }
    },
    {
      "story": "Validate OTP for driving test flow",
      "name": "driving_test_flow: Validate OTP",
      "method": "POST",
      "path": "auth/validate-otp",
      "body": {
        "email": "vickkycodegenius@gmail.com",
        "otp": "377101"
      },
      "requires": [
        "super_admin_token"
      ],
      "assertions": {
        "status": 201
      }
    },
    {
      "story": "Validates the license number of the user",
      "name": "driving_test_flow: verify license",
      "method": "POST",
      "path": "license/verify",
      "body": {
        "licenseNo": "${licenseNo}",
        "studentCertNo": null
      },
      "extract": {
        "student_email": "data.email"
      },
      "assertions": {
        "status": 201,
        "body": {
          "success": {
            "exists": true
          }
        }
      }
    },
    {
      "story": "Student makes application payment",
      "name": "driving_test_flow: Student makes application payment",
      "method": "POST",
      "path": "payments/initiate",
      "body": {
        "type": "pre_registration_payment",
        "email": "${student_email}",
        "description": "Payment licence pre registration",
        "successRedirectUrl": "https://localhost:3000/payment/gateway/success",
        "failureRedirectUrl": "https://localhost:3000/payment/gateway/failure"
      },
      "extract": {
        "paymentReference": "reference"
      },
      "assertions": {
        "status": 201,
        "body": {
          "success": true,
          "reference": {
            "exists": true
          }
        }
      }
    },
    {
      "story": "Submit Driving Test",
      "name": "driving_test_flow: Submit Driving Test",
      "method": "POST",
      "path": "driving-test/submit-driving-test",
      "body": {
        "certificateNo": "${certificateNo}",
        "applicationNo": "DRLP/2025/849367",
        "score": 91,
        "answers": [
          {
            "category": "Vision",
            "question": "Do you have any eyes Issues",
            "result": "No"
          },
          {
            "category": "Vision",
            "question": "Vision Assessment",
            "result": "Passed"
          }
        ],
        "licenseClassId": 1,
        "vehicleType": "Toyota Camry 2021",
        "location": "Ahmadu Bello Expres Way",
        "files": [
          {
            "fileId": 3,
            "documentType": "testFile"
          }
        ]
      },
      "requires": [
        "super_admin_token"
      ],
      "assertions": {
        "status": 201
      }
    }
  ]
}
