import java.text.SimpleDateFormat

plugins {
    id 'java'
}

group 'com.btl.test'
version '1.0-SNAPSHOT'
sourceSets {
    test {
        java {
            srcDirs = ['src/test/java']
        }
    }
}

test {
    useJUnitPlatform() // enables JUnit 5 discovery
}

repositories {
    mavenCentral()
}

dependencies {
    // REST Assured
    testImplementation 'io.rest-assured:rest-assured:5.4.0'
    testImplementation 'org.hamcrest:hamcrest:2.2'

    // Jackson for JSON parsing
    implementation 'com.fasterxml.jackson.core:jackson-databind:2.17.1'

    // JUnit 5
    testImplementation 'org.junit.jupiter:junit-jupiter-api:5.10.0'
    testRuntimeOnly 'org.junit.jupiter:junit-jupiter-engine:5.10.0'
}

test {

    // get project property or fallback
    def envProp = project.hasProperty('env') ? project.getProperty('env') : 'dev'

    // pass it as system property to test JVM
    systemProperty 'env', envProp

    // Generate a timestamp string, e.g. 2025-06-25_102030
    def timestamp = new SimpleDateFormat("yyyyMMdd_HHmmss").format(new Date())

    // Customize the test report output directory to include the timestamp
    reports.html.outputLocation = file("$buildDir/reports/tests/test_$timestamp")

    // Optionally also customize XML report dir similarly
    reports.junitXml.outputLocation = file("$buildDir/test-results/test_$timestamp")
    useJUnitPlatform()
    include '**/ApiSuiteTest.*'  // or '**/*Suite.*' if you want
        testLogging {
            events "failed"
            exceptionFormat "short"
            showStandardStreams = true
        }
        forkEvery = 0

}